{% extends "@ZeutzheimPpint/layout_home.html.twig" %}

{% block content %}
{{ parent() }}
<div class="container">
	
	<h1>Package Platform Integration Tool</h1>
	
	<h2>Suche</h2>
	{{ form(searchForm) }}
	{% if searchResults is defined %}
		<hr>
		<h2 id="search-results">Search results</h2>
		{% if searchResults is empty %}
			<h3>No results</h3>
		{% else %}
			<table class="packagetbl table table-condensed table-hover table-striped table-bordered">
				<thead>
					<tr>
						<th style="width:66px;">ID</th>
						<th>Name</th>
						<th>Version</th>
						<th style="width:100px;">Platform</th>
						<th style="width:60px;">Score</th>
					</tr>
				</thead>
				<tbody>
					{% for id,version in searchResults %}
					<tr>
						<td>{{ version.id }}</td>
						<td><a target="_blank" href="{{ version.package.platform.baseUrl ~ version.package.url }}">{{ version.package.name }}</a></td>
						<td>{{ version.name }}</td>
						<td>{{ version.package.platform.name }}</td>
						<td class="{{ version._percentScore > 0.66 ? 'score_green' : (version._percentScore > 0.5 ? 'score_orange' : 'score_red') }}">{{ version._score|number_format(3) }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		{% endif %}
		<pre>{{ lastQuery }}</pre>
	{% endif %}
	
	<hr>
	<h2>Platformen</h2>
	{% for id,platform in platforms %}
		<h3>{{ id|capitalize }}</h3>
		<div>Package count: {{ platform.count }}</div>
		<div>Indexed package count: {{ platform.indexed_count }}</div>
		<div>Error package count: {{ platform.error_count }}</div>
		<h4>Last added:</h4>
		<table class="packagetbl table table-condensed table-hover table-striped table-bordered">
			<thead>
				<tr>
					<th style="width:66px;">ID</th>
					<th style="width:200px;">Name</th>
					<th style="width:150px;">Added date</th>
					<th style="width:120px;">Latest version</th>
					<th class="desc">Description</th>
				</tr>
			</thead>
			<tbody>
				{% for package in platform.last_added %}
				<tr>
					<td>{{ package.id }}</td>
					<td><a target="_blank" href="{{ package.platform.baseUrl ~ package.url }}">{{ package.name }}</a></td>
					<td>{{ package.addedDate|date('Y-m-d H:m:s') }}</td>
					<td>{{ package.versions|length > 0 ? (package.versions|first).name : 'N/A' }}</td>
					<td class="desc">{{ package.description|raw }}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
		<h4>Last indexed:</h4>
		<table class="packagetbl table table-condensed table-hover table-striped table-bordered">
			<thead>
				<tr>
					<th style="width:66px;">ID</th>
					<th style="width:200px;">Name</th>
					<th style="width:150px;">Indexed date</th>
					<th style="width:120px;">Latest version</th>
					<th class="desc">Description</th>
				</tr>
			</thead>
			<tbody>
				{% for package in platform.last_indexed %}
				<tr>
					<td>{{ package.id }}</td>
					<td><a target="_blank" href="{{ package.platform.baseUrl ~ package.url }}">{{ package.name }}</a></td>
					<td>{{ package.indexedDate|date('Y-m-d H:m:s') }}</td>
					<td>{{ package.versions|length > 0 ? (package.versions|first).name : 'N/A' }}</td>
					<td class="desc">{{ package.description|raw }}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
		<hr>
	{% endfor %}
</div>
	
{% endblock %}
